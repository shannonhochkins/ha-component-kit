
import { Meta, Markdown, Title, Source } from '@storybook/blocks';
import { DEFAULT_FILENAME } from '../packages/core/bin/constants';


<Meta title="INTRODUCTION/TypescriptSync" />

# Description
Extends the typescript types for @hakit/core & @hakit/components on the consumer side so that you have full intellisense of your entities/services available on your home assistant instance.
There's a cli script and a node script available to generate/sync the types.

If your home assistant instance adds new entities or new services, simply re-run the script!

# Prerequisites

1. Install the latest version of @hakit/core:
<Source dark code="npm i @hakit/core@latest" />

2. Create a [Long Lived Access Token](https://developers.home-assistant.io/docs/auth_api/#long-lived-access-token) for your home assistant instance. You can create one in your home assistant instance at the bottom of your profile page.

## cli
Once you have the latest, you should be able to run the following in a terminal:
<Source dark code="hakit-sync-types --token YOUR_LONG_LIVED_TOKEN -url YOUR_HOME_ASSISTANT_URL" />
To find see other properties that are available:
<Source dark code="hakit-sync-types --help" />


## Node Script
Simply create a new file in your project and add the following, can be either typescript or javascript:

<Source dark code={`
// generate-types.ts
import { typeSync } from '@hakit/core/sync';

async function runner() {
  await typeSync({
    url: 'YOUR_HOME_ASSISTANT_URL',
    token: 'YOUR_LONG_LIVED_TOKEN'
  });
}
runner();
`} />

or as commonjs:

<Source dark code={`
// generate-types.js
const { typeSync } = require('@hakit/core/sync');

async function runner() {
  await typeSync({
    url: 'https://rwdwrtzkr59smlxgb934b72q647a3zr1.ui.nabu.casa',
    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJmN2M1YzkwYmYxMGM0ZjI2YjdkYjI4NDI1MDI3YWViZSIsImlhdCI6MTY5MjU5NDQ1MCwiZXhwIjoyMDA3OTU0NDUwfQ.QbdMf_A0nVovZNyV5ZPpeRaqWfz4NwWnXuhV5pQ0WCw'
  })
}

runner();
`} />

Then execute with: `node generate-types.js` or `ts-node generate-types.ts`

## Output

Both of the above will generate a file (by default) in the current working directory unless the --outDir flag was provided to either the cli script or the node script.
You will then have to link this to your tsconfig file in the `include` section before you import your src files.

<Source dark code={`
// tsconfig.json
{
  "include": [
    "${DEFAULT_FILENAME}", // Note: if you provided a custom filename flag or outDir this will need to change to reflect your name/path
    "src",
  ]
}

`} />

## Result

If successful, when you import a hook of say "useEntity" you should get complete intellisense for services and entities!

## Recommended
I recommend you run this script before every build, so that you always have the latest types available to you and you catch an errors from changes in home assistant.

<Source dark code={`
// package.json
{
  "scripts": [
    "build": "your build script",
    "prebuild": "hakit-sync-types --token YOUR_LONG_LIVED_TOKEN -url YOUR_HOME_ASSISTANT_URL"
  ]
}

`} />

## Linting

Lint the resulting file yourself, it being a separate step allows some output and better debugging when the file ends up invalid, and you can bring your own linter rules.
